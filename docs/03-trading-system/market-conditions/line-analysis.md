# 線分析と行帰判定

## 📋 概要

線分析と行帰判定は、各時間軸での線への到達率を統計的に分析し、取引における行帰（高値・安値更新）の判定を精密化する手法です。到達率データと行帰ロジックの組み合わせにより、高精度な相場分析を実現します。

## 📊 線への到達率確認結果

### 1時間足
- **到達率**: 71.4%（到達数：20回、非到達数：8回）
- **非到達時ズレ平均**: 4.6p
- **獲得合計**: 107.4p（到達時：134.4、非到達時：-27.0p）

### 30分足
- **到達率**: 78.6%（到達数：44回、非到達数：12回）
- **非到達時ズレ平均**: 2.6p
- **獲得合計**: 114.0p（到達時：143.1p、非到達時：-29.1p）

### 15分足
- **到達率**: 85.6%（到達数：95回、非到達数：16回）
- **非到達時ズレ平均**: 1.7p
- **獲得合計**: 221.9p（到達時：325.8p、非到達時：-103.9p）

### 5分足
- **到達率**: 99.7%（到達数：360回、非到達数：1回）
- **非到達時ズレ平均**: 0.06p
- **獲得合計**: 408.5p（到達時：412.2p、非到達時：-3.7p）

### 1分足
- **到達率**: 55.2%（到達数：975回、非到達数：790回）
- **非到達時ズレ平均**: 1.1p
- **獲得合計**: 323.5p（到達時：455.4p、非到達時：-131.9p）

## 📈 到達率分析の知見

### 時間軸別の特徴
1. **5分足が最も高い到達率（99.7%）**
2. **1分足は到達率が低い（55.2%）が取引機会が多い**
3. **中間時間軸（15分、30分）は良好なバランス**

### 収益性の観点
- **全ての時間軸で正の期待値**
- **15分足が最も高い収益（221.9p）**
- **5分足が最も安定（到達率99.7%）**

## 🔄 取引用の行帰の見方

### 問題事例の分析
**10/7 12:05の事例**：
- 高から下げてきている箇所で30分に対して、1〜15分が反対方向への転換としてローソクの行帰がそろっている
- 30分の足の最後には下方向にそろっているが、途中で反対の判断を出してしまっている

### 改善策
**直近最高値／最安値を転換確認対象の時間足のものを用いて、足の行帰評価を行う**：
- 更新周期を各内包の時間足にて実行する

## 🎯 行帰判定の新ロジック

### 基本原則
1. **軸時間足の平均足の陰陽を上下とする**
2. **軸時間足の陰陽が連続している区間内の最高／最安を保持する**

### 陰線の場合の判定
- **最安を更新した時**: 下行
- **最安を更新しなかったら**: 下帰
- **区間の開始点の始値を超えたら**: 上
- **最高を更新したら**: 上行
- **最高を更新しなかったら**: 上帰

### 問題点と解決策
**問題**: 進行方向に対してを単純な高値／安値更新とした場合、更新しないタイミングですぐに帰判定が入ってしまう

**解決**: 平足の転換〜転換までの期間における高値／安値の更新有無で行を維持するのか帰に変わったのかの判断を行う形式に見直す

## 📊 行帰更新パッケージ

### 実装パッケージ一覧
- 行帰軸5更新1/行帰軸15更新1/行帰軸30更新1/行帰軸60更新1/行帰軸240更新1
- 行帰軸15更新5/行帰軸30更新5/行帰軸60更新5/行帰軸240更新5
- 行帰軸30更新15/行帰軸60更新15/行帰軸240更新15/行帰軸60更新30/行帰軸240更新30/行帰軸240更新60

### 判定式の例
```
=IF(O104>O108,1,IF(O104<O108,2,N2357))
=IF(AND(O104>=O108,O104<=O107),1,IF(AND(O104<=O108,O104>=O107),2,0))
=IF(O107>O108,1,IF(O107<O108,2,N2359))
=IF(AND(O104>=O107,O104<=O106),1,IF(AND(O104<=O107,O104>=O108),2,0))
=IF(O106>O108,1,IF(O106<O108,2,N2361))
=IF(AND(O104>=O106,O104<=O105),1,IF(AND(O104<=O106,O104>=O105),2,0))
=IF(AND(O104>=O107,O104<=O105),1,IF(AND(O104<=O107,O104>=O105),2,0))
=IF(AND(O104>=O108,O104<=O106),1,IF(AND(O104<=O108,O104>=O106),2,0))
=IF(AND(O104>=O108,O104<=O105),1,IF(AND(O104<=O108,O104>=O105),2,0))
=IF(O105>O108,1,IF(O105<O108,2,N2366))
```

## 🔧 転換足の処理

### 帰でも信号を出す条件
**対象の時間足まで方向がそろったら、帰でも信号を出す**

### 内包処理の疑問点
**帰方向に対しては、安値更新がかかっていても、内包が返すと言ったら返す？**

### もみ処理の検討
**取引軸時間足以降において、転換タイミングが来ている場合**：
- もみとして、15分の転換判断を保留する？
- 抜け方向（転換タイミング時間足の先足以降）を見て判断して、その方向のみに対してエントリーする

## 📈 転換足の信号確定条件

### 信号確定の要件
1. **内包の行帰方向と信号成立方向が合致している**
2. **今足の信号成立方向が合致している**
3. **上記2条件が満たされた場合、信号確定**

## 🎯 実践的な活用

### 時間軸の選択
1. **安定性重視**: 5分足（到達率99.7%）
2. **収益性重視**: 15分足（獲得221.9p）
3. **機会重視**: 1分足（取引回数最多）

### リスク管理
1. **非到達時のズレを考慮したストップロス**
2. **時間軸別の期待値に基づくポジションサイズ**
3. **到達率を考慮した利確目標設定**

---

## 📅 出典
- **ファイル**: 20200207_線への到達率確認結果.txt（2020年2月7日）
- **ファイル**: 20200330_取引用の行帰の見方.txt（2020年3月30日）
- **カテゴリ**: 取引システム・市場状況分析