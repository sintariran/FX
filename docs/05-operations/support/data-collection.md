# データ収集（オメガのJava実装）

## 📋 概要

オメガシステムにおけるJavaによるデータ収集は、ランキング作成、取引履歴の集計、勝率計算などを自動化し、効率的な運用を実現するシステムです。

## 🎯 システム構成

### 役割分担
- **Java**: 全体のランキングを作成
- **FM**: 詳細な処理を実行

### 主要機能
1. **Javaで計算した取引履歴の情報を集計する**
2. **勝率を計算する**
3. **計算したデータを読み込んで、FMの中で条件にあった勝率○以上を選択**
4. **元のデータからさらに絞り込んで選んで固定**
5. **ランキングのデータから選ぶための要素を出す**

## 📊 データ処理フロー

### 現行プロセス
1. **実際にオートで回しているときにチェンジをする**
2. **その時にランキングを見に行って吐き出す**
3. **今現在既存でまわしているJavaはExcelで別途計算しているデータと合算してFMで計算**

### 自動化提案
**ランキングで選ぶというのをすべて組み込んで自動化**

## 🔧 実装上の課題と対応

### 1. 獲得Pipsの計算

#### 現状の問題
- **獲得Pipsは全部合算したものを出している**
- **BuyとSell方向の獲得pipsがあって、純粋な獲得ではない**
- **Buyが入っている間ではSellを省いて計算している**

#### 必要な修正
- 平均獲得やDDをExcelで計算している部分の統合
- 既存Javaにそれを組み込む必要

### 2. ナンピンフラグの処理

#### 問題点
**ナンピンのフラグをたてるところがあって、松永さんが使っていたデータではナンピンはできないはずだから、フラグの立て方が誤っていてそこを直さないといけない**

### 3. ランキングの統合
**Javaのところで複数のランキングがでてきて、それをくっつけてまとめている**

## 📈 チェンジ処理の自動化

### 現行のチェンジフロー
1. **チェンジする信号があった時にフラグとなるファイルを吐き出す**
2. **それが来た時にJavaがトリガーとなってランキングを確認しにいって変える**

### 詳細プロセス
1. チェンジフラグたつ
2. シグナル止める
3. その日のランキングを出す
4. 購読する
5. セットする
6. 野島さんに確認する

## 🎯 ランキング管理の改善

### 現状の課題
- **購読するのは各通貨ペアで5つある**
- **ただ実際に動くのは3つある**
- **3つの中の取引履歴のデータを読み込んで順位を入れ替える**

### 改善提案
**今の順位はどうなんですかっていうのをFMでやっているが、どのたびにファイルを読み込む必要があるのでJavaでやってしまったほうがいいのではないか**

## 💻 実装の最適化

### パフォーマンス改善
1. **ファイル読み込み回数の削減**
2. **メモリ内でのデータ処理**
3. **キャッシュの活用**

### 処理の統合
1. **Excel処理のJava化**
2. **FMとJavaの役割最適化**
3. **リアルタイム処理の強化**

## 🔍 データ品質管理

### 検証項目
1. **獲得Pipsの正確性**
2. **ナンピンフラグの妥当性**
3. **ランキング計算の整合性**

### エラー処理
1. **データ欠損時の対応**
2. **異常値の検出**
3. **自動リカバリー機能**

## 📊 運用監視

### 監視項目
1. **処理時間**
2. **メモリ使用量**
3. **エラー発生率**

### レポート機能
1. **日次処理統計**
2. **パフォーマンス分析**
3. **改善提案の生成**

## 🎯 今後の展開

### 短期目標
1. **ナンピンフラグの修正**
2. **獲得Pips計算の改善**
3. **自動化範囲の拡大**

### 長期目標
1. **完全自動化の実現**
2. **AI/MLの活用**
3. **リアルタイム最適化**

---

## 📅 出典
- **ファイル**: 20191103_オメガのJavaによるデータ収集.txt（2019年11月3日）
- **カテゴリ**: 運用・保守・サポート