# システムチェック

## 📋 概要

システムチェックは、オペレーションシステムの正常動作を確保するための体系的な検証プロセスです。空白処理、評価式、階層処理、接続関係など、多岐にわたるチェック項目を管理します。

## 🔍 主要なチェック項目

### 1. 空白・NULL処理

#### 問題事例
- **空白時にNormalとして処理**
  - 階層処理時に配列の列数を増やした関係で、値の代入が正常に行われていなかった

- **空白しかないはずの箇所にNULLがある**
  - stateがNULLだった際に、その情報をうわがいていた（1-2830）
  - 変換処理時点でNULLを空白に置き換える処理を入れた

#### 対策
- NULLと空白の区別を明確化
- 初期状態の適切な管理
- 値が0の時の特別処理

### 2. 評価式関連

#### 問題事例
- **評価式内でのターゲットに対する変換処理関数の使用間違い**
- **評価式の中でDelayパッケージの時に参照する先が1つ前を見ていなかった**
- **評価式の中でパッケージの時に確認する場合の場合分け式がパッケージ時にも他の条件を確認する形式になっていた**

#### 特殊パッケージの処理
- **特殊パッケージの処理フォーマットのズレ**
  - SLとBLのORは、Sタイプ
  - 32-xはPhaseタイプの例外処理

### 3. 階層・接続関係

#### 階層処理の問題
- **1階層で他のPkgを読んでいるものがいた**
  - 1-3151が5-1855を呼ぶ
  - 2-75が1-2834を呼ぶ → 自律神経がつながっていない
  - 値が0の時に値を渡すという処理がされていない → NULL化

#### 接続関係の構築
- **接続関係構築が軸時間、軸通貨から1つ隣接するパッケージまでしか接続を構築していなかった**
  - 接続の構築先を使用対象となるパッケージ全体に広げた
- **全ての材料フォーマットの接続関係が構築されていない**
  - フォーマット設定処理において、時間足のループを先足側から回すように見直し

### 4. ルート番号・参照関係

#### 問題事例
- **指定のルート番号が異なる**（3-354 P2-297とP2-296の違い）
  - OR条件がチェック関数の想定に入っていない
- **存在しないルートIDを参照しているものがいる**
- **2-1037_1がBSなのに191で呼ばれている**
  - 接続関係の構築が正常にされず材料が正常に渡されない

### 5. ファイル処理

#### 読み込み問題
- **ファイルの読み込み時に完全一致でなく部分一致を使用していた**
  - 一部ファイルが正常に読み込めていなかった（新規追加ファイル名が類似）
  - 完全一致での読込形式に修正

#### 設定ファイル
- **process_check_listの設定内容が正常に反映されていない**
  - NULLと空白の影響
- **設定ファイルが誤っている共通周期と単一周期**

## 📊 チェックエンジンの実装

### 実装時間見積もり
1. **数の確認用エンジンの作成**: 1.5h
2. **値の確認用エンジンの作成**: 1h
3. **軸時間に合わせての切り替え機能**: 1h
4. **カオス部分の確認処理の差替え**: 1.5h
5. **残ズレ箇所の確認・修正**: 2h

### チェック機能
- **残不整合ファイルを自動でチェック対象としての絞り込みファイル出力機能の追加**
- **2段階で追って、もう一段下のルートまで見に行く**

## 🔧 システム修正項目

### 修正済み項目
1. **他通貨のループが階層ループの外だった**
   - ループの位置を変更
2. **ニーズの接続部分が他通貨に変換されない形になっていた**
   - 接続が正常に動作しない状態を修正
3. **SLをSに変換している箇所が判定上異常として出ている**
   - 例外処理を判定式に反映
4. **W指標の場合に他周期の判断処理結果が混ざってしまっていた**
   - 分かれるように修正

### 継続課題
1. **計算値が空白の箇所要確認**
2. **入力部はDelayの計算値が入っていないため、初期状態の保持が続いている**
3. **親の材料から引き継ぐ分とプロセスチェックリストから引き継ぐ分が必要**
   - プロセスチェックリストからの引き継ぎができる体制になっていない

## 📈 チェック項目の拡張

### PKG検証
- **PKGのチェック項目をどんどん足していって作っていけるようにする**
- **新しくシステムを作ったときにPKGでもともとあるチェック項目でチェックできる**

### 自動化可能な項目
1. **フォーマットチェック**
2. **接続関係の検証**
3. **値の妥当性確認**
4. **参照整合性チェック**

## 💡 今後の改善方針

### システム設計
1. **エラー検出の自動化強化**
2. **ログ機能の充実**
3. **リアルタイム監視機能**

### 運用改善
1. **定期的な自動チェックの実施**
2. **エラーパターンのデータベース化**
3. **修正履歴の管理強化**

---

## 📅 出典
- **ファイル**: 20191014_システムチェック.txt（2019年10月14日）
- **ファイル**: 20191015_システムチェック.txt（2019年10月15日）
- **ファイル**: 20191016_システムチェック.txt（2019年10月16日）
- **ファイル**: オペレーションシステムのチェックの仕組み.txt
- **カテゴリ**: 運用・保守・日常運用