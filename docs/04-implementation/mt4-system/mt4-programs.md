# MT4取引プログラム

## 📋 概要

MT4（MetaTrader 4）での取引プログラムは、取引信号の受付から処理まで、モジュール化された構成で実装されます。各エンジンが自律的に信号を出力し、段階的な処理により柔軟な取引実行を実現します。

## 🏗️ プログラム構成

### 主要コンポーネント
1. **元信号受付**
   - 外部からの取引信号を受信
   - 信号の妥当性チェック

2. **設定**
   - ロット計算
   - 初期設定

3. **処理**
   - エントリー処理
   - 決済処理

## ⚙️ ロット計算エンジン

### エンジンの分離設計
**財務、遷移、決済のやり方でエンジンを分ける**

#### 設計方針
- **項目ごとに分けて作ることで後でのつけたしを容易にする**
- **各エンジンの結果は自律神経として信号を出力する（常時垂れ流し）**

### エンジンタイプ
1. **財務エンジン**
   - 資金管理に基づくロット計算
   - リスク許容度の反映

2. **遷移エンジン**
   - 市場状態の遷移を考慮
   - 動的なロット調整

3. **決済エンジン**
   - 決済戦略に応じた調整
   - 部分決済の考慮

## 🔧 初期設定

### 基本パラメータ
- **スリッページ**
  - 許容価格差の設定
  - 市場環境に応じた調整

- **リクオート**
  - 価格再提示への対応
  - 自動再試行の設定

### 設定のパッケージ化
**設定内容がPkg化されて、最終的な取引信号として決まる**
- **段階を分けて処理する**

## 📊 作業手順

### EA（Expert Advisor）の開発段階

#### 第1段階：基本コピーEA
**コピー取引信号を受けてそのまま出力するEA**
- 信号の単純転送
- 動作確認用

#### 第2段階：フィルタリングEA
**コピー取引信号を受けて絞り込んだうえで出力するEA**

### フィルタリング対象項目
- **ポジション方向**
  - BUY（買い）
  - SELL（売り）

- **ロット範囲**
  - 最大ロット
  - 最小ロット

- **スリッページ**
  - 許容範囲の設定

- **時間**
  - 取引可能時間帯
  - 指定時刻での制限

## 💻 実装上の注意点

### モジュール設計
1. **独立性の確保**
   - 各エンジンの独立動作
   - インターフェースの明確化

2. **拡張性の考慮**
   - 新機能の追加容易性
   - 既存機能への影響最小化

3. **リアルタイム性**
   - 低遅延処理
   - 効率的な信号処理

### エラー処理
1. **接続エラー対応**
2. **取引エラー処理**
3. **ログ記録の充実**

## 🎯 開発優先順位

1. **基本機能の実装**
   - 信号受信・送信
   - 基本的な取引実行

2. **フィルタリング機能**
   - 条件判定ロジック
   - 動的フィルター

3. **高度な機能**
   - 複雑なロット計算
   - 市場適応型調整

---

## 📅 出典
- **ファイル**: 20190821_MT4取引プログラム.txt（2019年8月21日）
- **カテゴリ**: システム実装・MT4システム