# EA（Expert Advisor）開発

## 📋 概要

オペレーション取引用EAは、本エントリー、追加エントリー、ヘッジエントリーを統合的に管理し、Osの残量を考慮したマーケットインパクト対応を実現する高度な自動取引システムです。

## 🎯 必要機能

### エントリー機能
1. **本エントリー**
   - 基本的な新規ポジション構築

2. **追加エントリー**
   - 既存ポジションへの追加

3. **ヘッジエントリー**
   - リスク管理のための反対ポジション

## ⚙️ 基本設定

### 取引方向設定
- **BUY/SELL利用**
  - 買い専用、売り専用、両方向の選択

### ロット管理
- **ロット固定**
- **ロット倍数**
- **余剰証拠金変動**

### スリッページ設定

#### スリッページ利用タイプ
- 利用しない
- スプレッド加味
- スプレッド加味しない

#### エントリー時スリッページ
- 許容値以内
- エントリーできる状態
- エントリーできる状態で有利

#### 決済時スリッページ
- 即時決済
- スリッページ解消待ち

### スプレッド設定
- **スプレッド固定値設定**

### ストップロス・ヘッジ設定
- **基本設定**
  - ON/OFF切り替え
  - ヘッジ許容値

- **再エントリー**
  - ストップロス後再エントリー利用

- **ヘッジ解除条件**
  - ヘッジ解除プラス値
  - ヘッジ解除マイナス値

- **再ヘッジ設定**
  - 再ヘッジ利用
  - 再ヘッジ設定値
  - 再ヘッジ解除プラス値
  - 再ヘッジ解除マイナス値

### 時間制限
- **時間タイプ**
  - 開始時間・開始分
  - 終了時間・終了分

### ポジション数制限
- **BUYポジション数上限利用タイプ**
  - BUYポジション数上限

- **SELLポジション数上限利用タイプ**
  - SELLポジション数上限

### リスク管理
- **証拠金維持率下限利用タイプ**
  - 証拠金維持率下限

## 🌊 マーケットインパクト対応

### Osの残量を加味した取引

#### 実装内容
1. **Os残量の取得と計算**
   - Osの値を取得
   - 単一周期のOs残量から対象周期で取引できる残量を算出

2. **価格影響の予測**
   - 投入量に対してのOs変化量から価格変化とOs変化の関係を割り出す
   - 超短期周期のOsの量の変化と価格の変化の関係性からいくら入れると価格がどれだけ変化するのか

## 🔧 オメガ用EAの修正内容

### ヘッジ機能の拡張

#### ヘッジの追加条件
**※既存のヘッジと選択式にしたい**
- エントリー時に早期平均足が陰線
- エントリー価格以下かつ平均足がエントリーと逆方向に行かつその方向の陰陽

#### ヘッジの解除条件
- ヘッジ価格を割り込む場合
- 平均足が帰から行に切り替わったとき

#### 再ヘッジ条件
- 平均足が再度行に切り替わったとき

## 💻 実装上の考慮点

### パフォーマンス最適化
1. **リアルタイム処理**
   - 低遅延の実現
   - 効率的なデータ処理

2. **メモリ管理**
   - 適切なリソース使用
   - メモリリークの防止

### エラー処理
1. **取引エラー対応**
   - リクオート処理
   - 接続断対応

2. **ログ管理**
   - 詳細な取引ログ
   - デバッグ情報の記録

### セキュリティ
1. **アクセス制御**
2. **データ保護**
3. **異常動作の検知**

## 🎯 開発優先順位

### フェーズ1：基本機能
1. 基本的なエントリー・決済機能
2. シンプルなロット管理
3. 基本的なリスク管理

### フェーズ2：高度な機能
1. 複雑なヘッジロジック
2. マーケットインパクト対応
3. 動的パラメータ調整

### フェーズ3：最適化
1. パフォーマンスチューニング
2. 高度なリスク管理
3. AI・機械学習の統合

## 📊 テスト項目

### 単体テスト
- 各機能の個別動作確認
- エッジケースの処理

### 統合テスト
- 複数機能の連携確認
- 実際の取引シナリオ

### ストレステスト
- 高負荷環境での動作
- 異常市場での挙動

---

## 📅 出典
- **ファイル**: 201909041223_OP取引用EA検討.txt（2019年9月4日）
- **ファイル**: 20191020_オメガ用EAの修正.txt（2019年10月20日）
- **カテゴリ**: システム実装・MT4システム