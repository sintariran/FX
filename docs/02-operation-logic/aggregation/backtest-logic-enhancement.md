# バックテストデータを用いたロジック強化手法

## 📋 概要

バックテストデータを用いたロジック強化は、予測精度を数値化し、継続的な改善サイクルを確立する体系的な手法です。特に15分足平均足の予測精度において約80%の合致率を達成しており、この実績を基盤としたロジック最適化を行います。

## 🎯 全体方針

### 基本的なアプローチ
バックテスト結果を解析して予測精度を数値化することが、オペレーションロジック強化の第一歩です。具体的には、15分足（平均足）の各バー開始時に立てた予測と、バー終了時の実際の動きを比較し、どれだけ一致したかを統計的に評価します。

### 実績データ
前足（直前の足）の情報から次の15分足の平均足の陰陽（上昇・下降）を予測するロジックの精度は、**約80%前後の合致率**を達成しています。この「予測が的中した割合」を把握し、それを基にロジックを改善する方針が確立されています。

## 📊 指標シグナルの「重ね合わせ率」（一致率）の算出方法

### 基本概念
「指標の重ね合わせのパーセンテージ」は、複数のインジケーター（指標）のシグナルがどれだけ同方向に揃っているかを示す割合です。

### 計算例
- **ケース1**: 5種類の指標のうち4つが上昇方向（買いシグナル）を示している場合
  - 上昇シグナルの重ね合わせ率 = 4/5 = **80%**
  
- **ケース2**: 上昇3・下降2のように意見が割れている場合
  - 上昇方向の一致率 = 3/5 = **60%**
  - 下降方向の一致率 = 2/5 = **40%**

### 一致率の活用
- **高一致率（70%以上）**: 予測の確信度が高く、積極的なエントリーが可能
- **低一致率（50%前後）**: 方向の確信度が低く、慎重な判断やエントリー見送りを検討

## 🔍 バックテストによる予測精度の測定手順

### Phase 1: 予測と実績データの収集
1. **予測データの記録**
   - 各15分足開始時点での全指標の状態を記録
   - ロジックが予測する方向（上昇/下降）を保存
   
2. **実績データの記録**
   - 15分足終了時点での実際の平均足の方向（陽線/陰線）を記録
   - 予測と実績のペアデータを蓄積

### Phase 2: 指標重ね合わせ率の計算
1. **基本的な一致率計算**
   - 各バーの予測時点での指標一致率を算出
   - 「何％の指標が上昇/下降シグナルだったか」を数値化
   
2. **重み付け計算（オプション）**
   - 重要度の高い指標に重み付けを適用
   - 「買い寄り○％ vs 売り寄り○％」として算出

### Phase 3: 予測の的中率（合致率）の集計
1. **的中判定**
   - 予測方向 = 実際の方向 → ヒット
   - 予測方向 ≠ 実際の方向 → ミス
   
2. **精度計算**
   - 的中率 = ヒット数 / 総数
   - 現状: **約80%の合致率**を達成

### Phase 4: 一致率と精度の関連分析
1. **セグメント別分析**
   - 指標一致率100%時の予測的中率
   - 指標一致率70-90%時の予測的中率
   - 指標一致率50%前後時の予測的中率
   
2. **失敗パターンの特定**
   - 高一致率でも外れたケースの共通点
   - 特定指標が逆向きの場合の影響度
   - 経済指標発表等の特殊要因

## 🌐 関数合成によるパターン発見

### 網羅的パターン分析
PKG関数の組み合わせ（関数合成）を活用し、様々な条件の組み合わせパターンごとに結果を検証します。

### 具体的な分析例
```
パターン: 指標A上昇・B上昇・C下降
結果: 15分平均足が陽線で終わる確率 = X%
```

### パターン管理
- 高確率パターンにID（パッケージID）を付与
- エントリー強化/抑制の判断材料として活用
- 「どの指標セットが15分足の陰陽と一致しやすいか」を定量評価

## 💡 分析結果を踏まえたロジック改善

### 1. エントリー判断へのフィードバック
**改善施策**:
- 指標一致率70%以上でのみエントリー
- 指標が揃わない局面での見送り/ポジション縮小
- 確実性の高い局面（今足判断で合致率100%）を優先

### 2. 指標ウェイト調整
**最適化手法**:
- 予測成功に貢献度の高い指標への重み付け強化
- ノイズになりがちな指標の閾値調整または除外
- 全体のシグナル品質向上

### 3. 失敗パターンへの対応策
**具体的対策**:
- もみ合い時のトレンド判断保留
- 他時間軸の強いトレンドへの追従
- 乖離等の特殊ケースへの例外処理追加

### 4. 継続的な精度検証
**PDCAサイクル**:
1. ロジック修正の実施
2. バックテストでの合致率再測定
3. 改善効果の確認
4. 新たな仮説の検証

## 🎯 実装上の要点

### 重要な原則
- **複数要素の統合判断**: 単一指標ではなく複数指標・複数時間軸を総合
- **時間軸間の一貫性確認**: 各時間足での整合性を重視
- **定量的評価**: 数値化による客観的な改善効果測定

### 今後の発展方向
1. **短期的改善**
   - ルールベースの調整と検証の継続
   - 予知精度の段階的向上
   
2. **長期的展望**
   - 統計手法やAIによる自動チューニング
   - 機械学習の活用による適応的最適化

## 📈 期待される効果

### システムパフォーマンスの向上
- 15分足平均足の方向予測精度の向上
- 「理想的な動き」への収束
- 一致率と結果のギャップ縮小

### リスク管理の強化
- 低確信度局面でのエントリー回避
- 失敗パターンの事前検出
- 全体的な勝率向上

---

## 📅 メタ情報
- **作成日**: 2025年1月
- **カテゴリ**: オペレーションロジック・バックテスト強化手法
- **関連ファイル**: 
  - evaluation-methods.md（評価手法）
  - logic-verification.md（論理検証）
  - prediction-logic.md（予知ロジック）