# FXオペレーションロジック分析結果

## 概要

メモファイル群から抽出したFXトレーディングシステムのオペレーションロジックの包括的分析結果。システムの核心となる判断ロジックと実装指針をまとめる。

## 1. 核心概念の定義

### 1.1 同逆判定（前々足乖離による方向判断）

**定義**: 前々足の価格乖離状態から次の方向性を判断する手法

**条件**:
- MHIHとMJIHの方向一致性評価 (55.7%/53.5%の勝率)
- 不一致時はMMHMHとMMJMHの方向を確認 (56.1%/56.0%の勝率)
- MJIJとMMHMH/MMJMHの方向不一致時、MHの確定方向を確認 (55.8%/55.8%の勝率)

**実装データ**:
```
M: 前足
I: 今足  
J: 実勢
H: 平均
```

**計算方法**:
- 各時間足の平均足方向と実勢価格の位置関係
- 時間足間の方向一致性による確率的判断
- 転換足での逆向き判定による除外ルール

### 1.2 行帰判定（前足の動きから今足の方向予測）

**定義**: 相場の波動における行（進行）と帰（戻り）の判定システム

**基本理論**:
- 相場は一定区間内での往復運動（波形成）
- 平均足の転換点による方向性確定
- 大小時間足の連携による多段転換の判定

**行帰の種類**:
1. **行行**: 大きな流れで同方向継続
2. **行帰**: 大きな流れで一時的戻り  
3. **帰行**: 戻りから再度進行方向へ
4. **帰戻**: 完全な方向転換

**判定基準**:
- 平均足の陰陽連続性
- 基準線との位置関係
- 高値・安値更新有無
- 残足計算による距離評価

### 1.3 もみ・オーバーシュート判定

**もみ（レンジ相場）の特定**:
- 残足による評価
- レンジ幅が一定値未満
- 内包時間足での抜けタイミング評価
- 2x5成立状態での判定

**オーバーシュートの判定**:
- 前足Os残足が今足換算で2以上
- 転換方向と逆方向のオーバーシュート成立確認
- 周期接続による多段判断

### 1.4 時間足連携（1M, 5M, 15M, 30M の連携ロジック）

**時間足内包関係**:
- 短い時間足から長い時間足への影響伝播
- 各時間足の転換タイミング同期確認
- 先足転換足の有無による状況判定

**連携パターン**:
```
15M行、5M行: 0-T (強い継続)
15M行、5M帰: 0-T, T-S (調整段階)
15M帰、5M行: 0-T, T-S, T-L (転換準備)
15M帰、5M帰: T-S, T-M, T-L (転換確定)
```

## 2. エントリー・エグジット条件

### 2.1 エントリー条件

**基本条件**:
1. 前足の平均足が陰線（下方向エントリー時）
2. 転換判断の評価足の方向と合致
3. 周期の揃い成立
4. オーバーシュート成立確認

**除外条件**:
- 先足が返していない状態での逆方向転換
- 先足以降での周期の揃い成立箇所
- 前足と今足の周期の揃いがある場合

### 2.2 エグジット条件

**決済条件**:
1. 1分の揃いと前足以前のOPFFの揃い
2. 平均足/OPFFが転換している場合の時間足OPFF転換待ち
3. 時間足の接続点での決済実行

**早期決済**:
- 先足が返していない状態で前足まで逆方向転換
- 乖離での反対方向信号成立

### 2.3 ヘッジ戦略

**ヘッジ基本条件**:
- 今足の周期の揃い成立
- 前足・今足の平均足のいずれかがその方向
- もみ抜け方向との合致確認

**ヘッジ場合分け**:
- 行行状態: 前足・今足平均足が同方向、先足転換足タイミング
- カウンター: もみ中抜け方向の逆判定

## 3. 実装のための技術要件

### 3.1 必要データ構造

**価格データ**:
- OHLC（Open, High, Low, Close）
- 平均足価格（計算済み）
- 実勢価格（リアルタイム）

**時間足データ**:
- 1M, 5M, 15M, 30M, 1H, 4Hの同期データ
- 各時間足の平均足転換フラグ
- 残足計算値

**指標データ**:
- Os指標（増減、上下転換）
- Mac指標（方向性）
- 周期特定値（T、S、M、L周期）
- 基準線位置

### 3.2 計算アルゴリズム

**平均足計算**:
```python
# 平均足の基本計算式
heiken_close = (open + high + low + close) / 4
heiken_open = (prev_heiken_open + prev_heiken_close) / 2
heiken_high = max(high, heiken_open, heiken_close)
heiken_low = min(low, heiken_open, heiken_close)
```

**乖離判定**:
```python
# 時間足間乖離判定
def check_divergence(timeframe1, timeframe2):
    return timeframe1.direction != timeframe2.direction
```

**残足計算**:
```python
# 残足による距離評価
def calculate_remaining_distance(current_price, target_line, average_range):
    return abs(current_price - target_line) / average_range
```

### 3.3 状況状態管理

**状況の特定**:
- 事前状況（過去から現在まで）
- 転換足タイミング（先足、今足、無し）
- 行帰戻パターン分類

**状態の監視**:
- 今起きている状態（これから起こること）
- 周期の増減転換ポイント
- 線と実勢の交点タイミング

## 4. パフォーマンス指標

### 4.1 勝率データ（メモファイルより抽出）

**基本判定**:
- 全体: 19% (基準値)
- 単一周期Os: 52.5% (-200pips基準)
- 周期揃い: 52.8% (-300pips基準)
- 転換足: 64% (-400pips基準)

**高勝率要素**:
- もみ: 77% (-500pips基準)
- S_周期: 66.2% (-600pips基準)
- オーバーシュート: 550.6% (-900pips基準)
- OP1M: 527.2% (-1000pips基準)

### 4.2 評価指標

**方向性評価**:
- 上方向: 79回、下方向: 15回
- 行判定: 41回、帰判定: 53回
- T-S間での成立: 39回（高確率ゾーン）

## 5. 実装優先順位

### Phase 1: 基本ロジック実装
1. 平均足計算システム
2. 時間足内包関係の構築
3. 基本的な行帰判定

### Phase 2: 高度判定システム
1. 同逆判定アルゴリズム
2. オーバーシュート検出
3. もみ判定システム

### Phase 3: 取引システム統合
1. エントリー・エグジット信号
2. ヘッジ戦略
3. リスク管理システム

## 6. 重要な注意事項

### 6.1 ピンバー対応
- 10/7 16:51, 10/9 11:45で確認された事例
- MMJMJが逆向きでピンバー発生時の判定保留
- 次足での確認による転換判定

### 6.2 特殊条件
- 時間の切替り瞬間のファンダメンタル変動
- 経済指標発表時の流れ
- 他通貨フォロー関係による影響

### 6.3 システム制限
- 短い時間足での「なまし」有効性の限界
- 見える/見えない指標の事前確認必要性
- 確定要件での区間区切り重要性

## 7. 参考メモファイル

主要な分析対象ファイル:
- 20200115_オペレーションロジックまとめ.txt
- 20191001_オペレーションロジックの考え方.txt
- 20200731_グループ階層数調整.txt
- 20200918_オペレーション時間単体及び時間結合のロジック.txt
- 20200330_取引用の行帰の見方.txt
- 20200401_もみ検討.txt
- 20200922_状況状態の考え方.txt

---

**最終更新**: 2025年8月15日  
**分析者**: Claude Code  
**対象期間**: 2019年～2021年のメモファイル群