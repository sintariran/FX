# オペレーションロジック概要

## 📋 概要

オペレーションロジックは、パターン解析ではなく、相場がどういう状況でどのようになるのかを捕捉する総合的な分析手法です。時間軸の内包関係、平均足の転換、他通貨フォロー関係を統合し、精密な相場判断を実現します。

## 🎯 基本概念

### オペレーション（OP）の定義
**パターン解析ではない**：
- 相場がどういう状況でどのようになるのかを捕捉
- **どの時間帯でも判断できる**

### 相場の本質
**相場は一定区間の範囲を行ったり来たりするもの**：
- **つまり、波を形成する**
- AとBの切り分けで、**Bの方が大きい**となる
- つまり、**Bは連続する**

## 🌊 マーケットの流れ捕捉

### 基本アプローチ
**マーケットを平均足化する**：
- マーケットの平均の流れが見えるようになる
- 平均足が転換する場所がわかればOK
- **価格を常に出して、それが変わるのかを見る**

### 変化の判定
**流れが変わる場所の特定**：
- どこで変化するのか
- どこまで続くのか
- **変化するだけの量がどれだけあるのか**の質量解析

## 🔄 転換の仕組み

### 転換のタイミング
**平均が続かなくなるのが転換するところ**：
- 一度おろしてきても、その先がまだおろしていなければ、もう一度伸ばす
- **転換できるだけの位置にいない**ということ

### 時間と距離の関係
**平均的に時間が長くなって、距離を伸ばす**：
- 平均値を多くとる
- 伸びなくなると、返してくる
- **更新して、同じ形（陽線／陰線）を継続できなくなる**

## 📊 多段転換の概念

### 大小関係
**大きい流れと小さい流れ**：
- **大きい流れの方がゆっくり**
- **小さい流れの方が速い**
- 落ちる時に小さいものから大きいものにつながっていく

### 多段転換の問題
**小さいものが大きいものにつながらない時**：
- 小さいもので再度返してくるのか
- 大きいものまで返してくるのか分からない
- これが**多段転換**

## 💱 通貨影響の分析

### 基本要因
**価格が変動するためには**：
- **自通貨** OR **他通貨** しかない

### 他通貨の場合
- **フォロー関係を見れば分かる**

### 自通貨の場合
- **なましが発生している**（平均足のなまし）
- 平均を割り込んで来るかで判定
- 伸びているところか、降りてきているところかを判定

## ⬆️⬇️ 本トップと逆トップ

### 基本概念
**転換方向に対しての力の加減**：
- **平均の方向にフォローしている方向が本トップ**
- **逆に返してくるのが逆トップ**
- **逆トップは小さい**

### 行帰の存在
- **大きな行帰、小さな行帰が存在**
- その基準値もある
- 他通貨も行帰があり、その転換を見る

## 📍 確認ポイントの重要性

### 必要要素
**行帰のポイントでの確認ポイント**：
- 線の上、下の位置
- 行帰がどこで起きているのかの位置
- **位置の状況状態の把握**

### 時間の内包関係
**時間の内包関係における確認ポイント**：
- その変化のパターンが必要
- 時間の内包関係に対する見方
- **平均足の転換**

## 🔧 実装上の課題と改善

### 新規機能追加（2019年8月時点）
1. **なましの判定変更**（平均足の転換毎）
2. **なましの判定変更**（平均足の転換毎_前区間）
3. **時刻指標**
4. **もみとヘリの特定**
5. **5,15なまし中での1分のなまし外増からの転換**
6. **5,15なまし中での1分始値減からの転換**

### 前提条件
**以下のいずれかが来ている前提**：
- **5mなまし**
- **5m差分**
- 5-4又は5-5の足で1mトリガー又は始値の転換

### 課題点
**平均足のなまし（5m）と差分（5m）**：
- 来ていないかつ、もみでない箇所がある
- 対象箇所9箇所（上下5pips程度のレンジ相場）

## 🎯 設計方針の修正

### 間違った進め方の修正
**見えるところと見えないところを分けるやり方がNG**：
- 見えるか見えないかの確認は組み合わせロジックになっていない
- 確認対象の指標特性のチェック作業でしかない

### 正しいアプローチ
1. **確定要件で区間を区切る**
2. **その間を早めるために予知等の条件を入れて早める**
3. **対象の指標が見えるのか見えないのかで絞り込んで使用する指標を決める**

## ⚡ 白バンド外の処理

### レベル別の返し速度
**白バンド外でも時間軸によって返す速度が違う**：
- **1分だけなら**: 1分レベル
- **5分までなら**: 5分レベル  
- **15分までなら**: 15分レベル

### 予知の使用タイミング
- **残足が少ない時に使用**
- どこの予知としての評価になっているかが分からないため
- **加速を使うべき**（収束からの伸び）

## 🔄 もみ相場の対応

### もみ抜けの判定
**今足でもみ抜けの時に先足ももみの場合**：
- 基本的には抜けきらずに返してくる（カウンター）
- **先足が抜けるといっているのかの判断が必要**

### 抜ける時と返す時の違い
**判定要素**：
- **差分上下、差分増減の揃いで抜ける判定**
- 5分で抜ける時に15分のレンジで返す
- 15分のレンジを抜けるかは15分差分または15分予知で判定

## 📊 具体的な判定ロジック

### 基本条件
**何を見るタイミングか**：
- **行** = 先足抵抗線（10,30）
- **帰** = 今足抵抗線（10,30）
- 進行方向に存在する抵抗線を超える場合、**行となる**

### 転換判定
**先足平均足と同方向に転換するか**：
- 逆方向の場合、その状況は返せる状況なのか
- 収束から抜けるタイミングでなましが追い付かない
- **他が下といっているなら、抜ける**

### 1-5転換の判定
- **1-5転換を入れる時と入れない時の判断**

## 🎯 2020年版の改良内容

### 1m He転換の処理
- **1m He転換確定時に1mOs予知と1mMA10との位置関係を見る**
- 5m-1mで平足予知がなましている時、1m予知価格を1m実勢が抜いた時に**行行トップ**

### なまし非成立の処理
- **1mと5mでなましが非成立になった場合は再度伸ばす**
- 行行の場合は上とする（期間10の上で予知がなましていない状態に切り替わった時）

### 多段の抵抗線判断
- **多段の時の抵抗線の判断を入れる**
- 10-30交点のレンジでの処理
- 多段の途中の行行の小さいトップ以降の下げ

## 📈 予知判定のロジック

### 基本パターン
1. **今＞先、今予知＞今** ⇒ **上**
2. **今＞先、今予知＜今、今予知＞先、先予知＞先** ⇒ **上（多段）**
3. **今＞先、今予知＜今、今予知＞先、先予知＜先** ⇒ **下（伸びる）**
4. **今＞先、今予知＜今、今予知＜先** ⇒ **下（内包予知）**
5. **今＜先** ⇒ 鏡（※前足が逆方向を向いている場合、非成立）

### 周期の使い分け
- **Os0点での判断用の予知**: Osの周期
- **線の交点での判断用の予知**: 線の長い方の周期
- **間にいる時**: 最後に発生した線の交点の周期を使用

## 🔧 現在の課題と対応

### 接続の問題
- **行行の接続が正常に出ていない**
- **確定の追加**が必要

### 反応速度の改善
- **行行予知の判断内容の転換タイミングを使った方が反応が速い**
- 1分の方向ないし、トリガーがないかあっていない

### 多段途中の出力問題
- **多段の途中で出てしまう**
- 1分行行における最悪（単純な最悪として出力）

## 🕐 時間軸特定とターゲット設定

### 見たい時間の特定
**対象時間の特定と到達点算出**：
- **対象時間を特定**した上で、転換時に次の到達点を算出
  - **価格**
  - **時刻**（残足）

### 内包関係による捕捉
**到達までの間を短い時間で確認**：
- **Os予知で到達点と残足を算出**
- どこまで行くのかを判定
- 内包関係で全体を捕捉

### 時間接続のタイミング
**前足による転換タイミング特定**：
- 見たい時間の１つ前の時間で次の時間につながる転換のタイミングをとらえる
- **行帰の状況特定**をして、何をどのタイミングで見るべきかを特定

## 🧮 改良版判定ロジック（2020年1月版）

### 足記号の定義
- **M**: 前足
- **I**: 今足  
- **J**: 実勢
- **H**: 平均

### 基本判定ルール
**MHIHとMJIHの揃い判定**：
- **MHIHとMJIHがそろったらその方向**: 55.7%/53.5%

**非揃い時の判定**：
- **MMHMHとMMJMHの方向**: 56.1%/56.0%
- **MJIJとMMHMH/MMJMHの方向が合致しない場合**: MHの確定方向を確認（55.8%/55.8%）

### 転換抑制ルール
**転換させない条件**：
- MHIHとMJIHの転換足でMMHMHとMMJMHが逆を向いていて、MHの確定方向も逆の場合：転換しない（56.0%/56.0%）
- 次の足でMMHMHやMHが転換したら、それをトリガーとして判断

### カウンター判定
**カウンター条件**：
- **MJIHが転換した際**：
  - ぜんもみの時は、全時間そろうまでカウンター
  - Mもみで2x5成立している場合、カウンター

### ピンバー対応
**ピンバー判定事例**：
- 10/7 16:51 ピンバー
- 10/9 11:45 ピンバー

**ピンバー処理ルール**：
- MJIHが転換した際に、MMJMJがMMJMH,MMHMHと逆を向いている場合
- その足だけは判断を待って、次の足でMMJMJが逆向きのまま（または、ピンバー）の場合、転換させない

## 🔧 追加パッケージ仕様

### MOD関数群
1. **type_z**: 1,2で構成されるパッケージのステート切替り時刻を起点として軸時間毎にカウントアップ
2. **type_co (count)**: 指定数字を基に累積値を計算（5指定なら5+4+3+2+1）
3. **type_sd (sum_down)**: 対象時刻を分換算に置き換える関数
4. **type_mn (minute)**: 現在時刻または条件指定時刻から算出
5. **type_sg (sum_group)**: 区間毎の値の和算処理
6. **type_nl (near_line)**: 隣接線の価格・周期特定
   - モード1: 直近の上価格
   - モード2: 直近の下価格  
   - モード3: 直近の上周期
   - モード4: 直近の下周期
7. **type_ss (specified_shuki)**: 周期特定（トリガー成立時の最終成立周期保持）

### 理論値・平均関数
**Type_I (ideal)**：
- 指定された上下区間で最小値・最大値を算出
- それぞれの足で方向を出力

**Type_AS (average_section)**：
- 素材1: 平均したい区間用PKG
- 素材2: 平均したい数値（価格）PKG
- 出力1: 現区間の平均
- 出力2: 1つ前区間の平均

## 🌊 時間軸統合判定（2020年1月版）

### 線の交点による分析
**基本分析要素**：
- **線の交点により時間軸と周期を特定**
- **線の中での価格位置を特定**し、隣接線に対しての行帰を確認
- **平均足の陰線陽線が1分からどの時間軸まで揃っているか**で返し範囲を評価

### 評価開始トリガー
**対象時間の平均足転換**

### 方向性判定
**今が上方向か/下方向か**：
- **1分がどちらを向いているかで最小の方向が決まる**
- 見たい時間の方向は接続している時間が前足まで接続している場合に変化が発生

### 行帰による方向確認
**進行方向の確認要素**：
- **前足の増減がその方向を向いている**（上/下側のいずれかの周期に対して）
- **１つ小さい時間軸の上下いずれかの行帰りが進行方向を向いている**
- **前足、前々足のMJHI/MHIHがその方向に行くといっている**

### もみ相場の判定
**もみ中の特別処理**：
- **もみはもみ中の時間軸の行帰の方向がそろう**
- 見たい時間軸の前足までで評価（行帰の切替りまでは待てない）
- **もみぬけで急に上げてくる**場合: 前々と先の実勢の関係性で判定

### 方向判断の分類
1. **全もみ方向判断**（全行帰の方向揃い）
2. **通常方向判断**（各時間で1つ以上方向揃い）
3. **抵抗線がない位置の場合**（前足よりも手前のものが全て返すという条件）
4. **全抜け状態**（先に抵抗線がない状態も方向を示すものとして扱う）

### 時間軸接続フロー
**1分確定 ⇒ 1分帰 ⇒ 5分つながる ⇒ 5分確定 ⇒ 5分確定 ⇒ 5分帰 ⇒ 15分つながる**

---

## 📅 出典
- **ファイル**: 20190821_オペレーションロジック整理.txt（2019年8月21日）
- **ファイル**: 20190922_オペレーションロジック整理.txt（2019年9月22日）
- **ファイル**: 20190925_オペレーションロジック整理.txt（2019年9月25日）
- **ファイル**: 20190926_オペレーションロジック整理.txt（2019年9月26日）
- **ファイル**: 20191001_オペレーションロジックの考え方.txt（2019年10月1日）
- **ファイル**: 202001111504_オペレーションロジックまとめ.txt（2020年1月11日）
- **ファイル**: 20200112_オペレーションロジックまとめ.txt（2020年1月12日）
- **ファイル**: 20200115_オペレーションロジックまとめ.txt（2020年1月15日）
- **ファイル**: 20200118_オペレーションロジックまとめ.txt（2020年1月18日）
- **カテゴリ**: オペレーションロジック・基本理論